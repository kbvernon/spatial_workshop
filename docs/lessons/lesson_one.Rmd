
---
title: "Spatial Data in R"
subtitle: "A reckless romp through the basics"
date: '`r Sys.Date()`'
output:
  xaringan::moon_reader:
    lib_dir: libs
    css: [xaringan-themer.css, custom_style.css]
    nature:
      highlightStyle: magula
      highlightLines: TRUE
      ratio: '16:9'
---

```{r, echo = FALSE, child = here::here("lessons/before_chunk.Rmd")}
```

## Outline

.pull-lleft[

<p style="margin-bottom:1.65em;"></p>

.bg-white.b--dark-gray.ba.bw1.br2.shadow-5.ph2.pv1.mh1.mt3.w-100[

1. Setup

2. Vectors
    - Basic plotting
    - Reading and writing
    - Projecting
    
2. Rasters
    - Basic plotting
    - Reading and writing
    - Projecting

]

]

.pull-lright[

```{r, echo = FALSE, fig.width = 800/72, fig.asp = 0.8, out.width = "90%", fig.align = "right"}

par(pty = "s",
    mfrow = c(1, 2),
    mar = c(2,2,2,0),
    oma = rep(1, 4))

plot(0,
     type = "n",
     xlim = c(0, 10),
     ylim = c(0, 10),
     xlab = "",
     ylab = "",
     xaxs = "i",
     yaxs = "i",
     xaxt = "n",
     yaxt = "n")

title(main = "Vector", 
      adj = 0, 
      line = 0.3,
      cex.main = 2)

xy <- par("usr")

rect(xleft = xy[1],
     xright = xy[2],
     ybottom = xy[3],
     ytop = xy[4],
     col = adjustcolor("#d4fcf5", alpha.f = 0.3))

box()

rect(xleft = 5,
     xright = 9,
     ybottom = 2,
     ytop = 6,
     col = adjustcolor("#de8500", alpha.f = 0.9),
     border = "#693f00",
     lwd = 3)

set.seed(12345)

n <- 20

x <- pmin(9.7, pmax(0.3, rnorm(n, mean = 3, sd = 1.5)))
y <- pmin(9.7, pmax(0.3, rnorm(n, mean = 6, sd = 1.5)))

points(x = x,
       y = y,
       bg = adjustcolor("#edc600", alpha.f = 0.6),
       col = "#967e02",
       pch = 21,
       lwd = 2,
       cex = 4)

lines(x = c(0.3, 0.3, 2.0, 2.5, 8.5, 9.8, 9.8),
      y = c(7.0, 0.3, 2.5, 1.5, 6.5, 9.8, 0.3),
      col = adjustcolor("#fffb00", alpha.f = 0.5),
      lwd = 10)

lines(x = c(0.3, 0.3, 2.0, 2.5, 8.5, 9.8, 9.8),
      y = c(7.0, 0.3, 2.5, 1.5, 6.5, 9.8, 0.3),
      col = "#d44402",
      lwd = 5)



m <- matrix(runif(100, min = 0, max = 100),
            nrow = 10,
            ncol = 10)

image(x = seq(0.5, 9.5, by = 1),
      y = seq(0.5, 9.5, by = 1),
      z = m,
      col = terrain.colors(100),
      xlim = c(0, 10),
      ylim = c(0, 10),
      xlab = "",
      ylab = "",
      xaxt = "n",
      yaxt = "n")

title(main = "Raster", 
      adj = 0, 
      line = 0.3,
      cex.main = 2)

grid(nx = 10,
     ny = 10,
     lty = 1,
     col = "gray50")

box()

```

]


---

## Setup

.pull-left[

```{r, echo = FALSE, out.width = "90%"}

knitr::include_graphics("figures/new_project_window.png")

```

]

.pull-right[

Create an R project folder  

- Go to _File_ > _New Project..._ > _New Directory_, 
- Specify a suitable folder name (no spaces!),   
- Choose an appropriate directory for the folder,  
- Click _Create Project_.

]






---

## Setup

.pull-left[

```{r, echo = FALSE, fig.asp = 3, out.width = "80%"}

knitr::include_graphics("figures/new_folder.png")

```

]
  
.pull-right[

Add _data_, _gis_, and _R_ folders
  
- In the View pane, go to the _Files_ tab,
- Click _New Folder_ and type the name of the folder, 
- Click _OK_.

]


---

## Setup

* Download and open _lesson_one.Rmd_.
  - In the Console, type 



* Install packages  

```{r, eval = FALSE}
# install packages
install.packages(c("here", "raster", "spData", "sf"))

install.packages("spDataLarge", 
                 repos = "https://nowosad.github.io/drat/", 
                 type = "source")

# attach packages
library(here)
library(raster)
library(spData)
library(spDataLarge)
library(sf)

```


---

## Where is here?

.pull-left[

```{r, echo = FALSE, out.width = "100%"}

knitr::include_graphics("figures/allison_horst_here.png")

```

.center[Artwork by [Allison Horst](https://github.com/allisonhorst/stats-illustrations)]

]

.pull-right[

<br>

The [`here`](https://here.r-lib.org/) package is your friend. [Ask anyone](https://github.com/jennybc/here_here).

```{r, eval = FALSE}
file.path()
## character(0)

here()
## [1] "C:/Users/bob/spatial_workshop"

file.path("R", "script.R")
## [1] "R/script.R"

here("R", "script.R")
## [1] "C:/Users/bob/spatial_workshop/R/script.R"

```

]



---

## Simple Features

_sf = data.frame_ (attributes + geometry) _+ crs + bbox_

```{r, echo = FALSE, out.width = "55%"}

data("world", package = "spData")

world <- subset(world, select = c(name_long, 
                                  continent,
                                  area_km2, 
                                  pop, 
                                  gdpPercap))

knitr::include_graphics("figures/allison_horst_sf.png")

```

.center[Artwork by [Allison Horst](https://github.com/allisonhorst/stats-illustrations)]

---
count: false

## Simple Features

_sf = data.frame_ (.rred[attributes] + geometry) _+ crs + bbox_

```{r, eval = FALSE}

plot(world["area_km2"])

```


```{r, echo = FALSE, fig.asp = 0.4, fig.width = 900/72, out.width = "75%"}

plot(world["area_km2"], key.pos = NULL, main = NULL)

```


---
count:false

## Simple Features

_sf = data.frame_ (attributes + .rred[geometry]) _+ crs + bbox_

```{r, fig.asp = 0.4, fig.width = 900/72, out.width = "75%"}

plot(st_geometry(world))

```



---

## Why sf?

1. It's faster
2. Plotting is better
3. It's JUST a data.frame
4. It's TIDY, meaning it is highly integrated with tidyverse packages
5. It's syntax is consistent, and you can pick out an sf verb by the `st` prefix*

<br><br><br><br><br>

* `st` originally meant "__S__patial and __T__emporal" in PostGIS, but support for temporal data was dropped, so it became "__S__patial __T__ype". [https://stackoverflow.com/questions/7234679/what-is-st-in-postgis](https://stackoverflow.com/questions/7234679/what-is-st-in-postgis)


---

## __s__imple __f__eature (`sf`)

```{r}
world

```

Each row is a _feature_.


---

## __s__imple __f__eature __c__olumn (`sfc`)

```{r, message = TRUE}
world$geom

```

The geometry column is a _list_.


---

## __s__imple __f__eature __g__eometry (`sfg`)

```{r, message = TRUE}
world$geom[[1]]

```

A single feature's geometry has a Well-Known Text representation of its vertices.


---

## From the ground up

```{r}
point1 <- st_point(c(432000, 4513100))
point2 <- st_point(c(436750, 4518500))

sf_column <- st_sfc(point1, point2, crs = 26912)

st_sf(id = 1:2, 
      location = "red butte canyon",
      geometry = sf_column)

```

Similar to `data.frame(col1 = ..., col2 = ...)`, but with a geometry column.




